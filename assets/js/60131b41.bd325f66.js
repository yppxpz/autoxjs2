"use strict";(self.webpackChunkautox_doc=self.webpackChunkautox_doc||[]).push([[6341],{9312:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>l});var o=t(4848),s=t(8453);const c={},r="MQTT",i={id:"rhino/base/mqtt",title:"MQTT",description:"6.5.9 \u65b0\u589e",source:"@site/docs/rhino/base/mqtt.md",sourceDirName:"rhino/base",slug:"/rhino/base/mqtt",permalink:"/docs/rhino/base/mqtt",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rhino/base/mqtt.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Keys \u6309\u952e\u6a21\u62df",permalink:"/docs/rhino/base/keys"},next:{title:"Storages \u672c\u5730\u50a8\u5b58",permalink:"/docs/rhino/base/storages"}},a={},l=[{value:"\u4ee3\u7801\u793a\u4f8b",id:"\u4ee3\u7801\u793a\u4f8b",level:2}];function p(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{id:"mqtt",children:"MQTT"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.code,{children:"6.5.9 \u65b0\u589e"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u7a33\u5b9a\u6027: \u7a33\u5b9a"}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:["MQTT \u6a21\u5757\uff0c\u91c7\u7528",(0,o.jsx)(e.a,{href:"https://github.com/eclipse/paho.mqtt.java",children:"org.eclipse.paho.client.mqttv3"}),"\u5b9e\u73b0"]}),"\n",(0,o.jsx)(e.h2,{id:"\u4ee3\u7801\u793a\u4f8b",children:"\u4ee3\u7801\u793a\u4f8b"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u4e3b\u9898\u8ba2\u9605\u3001\u53d1\u5e03\u3001QOS\u3001\u9057\u5631\u6d88\u606f"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'importPackage(Packages["org.eclipse.paho.client.mqttv3"]);\nimportClass("org.eclipse.paho.android.service.MqttAndroidClient");\n\n// \u8fde\u63a5\u3001\u8ba2\u9605\u914d\u7f6e\nconst MQTT_URL = "tcp://192.168.20.225:1883";\nconst CLIENT_ID = "MOCK";\nconst TOPIC = "ANDROID_MOCK";\nconst QOS = 2;\nconst USERNAME = "device";\nconst PASSWORD = "public";\n\nconst client = new MqttAndroidClient(context, MQTT_URL, CLIENT_ID);\nconst subscribeToTopic = () => {\n  try {\n    client.subscribe(\n      TOPIC,\n      QOS,\n      null,\n      new IMqttActionListener({\n        onSuccess: (token) => {\n          toast("MQTT \u8ba2\u9605\u6210\u529f");\n        },\n        onFailure: (token, error) => {\n          toast("MQTT \u8ba2\u9605\u5931\u8d25 " + error);\n        },\n      })\n    );\n  } catch (error) {\n    toast(error.message);\n    alert(\'MQTT\u8ba2\u9605\u9519\u8bef\\n\\n"\' + error.message);\n  }\n};\n\nconst initMQTT = () => {\n  // \u521b\u5efa\u914d\u7f6e\n  const mqttConnectOptions = new MqttConnectOptions();\n  mqttConnectOptions.setAutomaticReconnect(true);\n  mqttConnectOptions.setCleanSession(true);\n  mqttConnectOptions.setUserName(USERNAME);\n  mqttConnectOptions.setPassword(Array.from(PASSWORD));\n  // \u9057\u5631\u6d88\u606f QOS = 1, retained = true\n  let willMsgJavaString = new java.lang.String("i am gone");\n  let willMsgJavaBytes = willMsgJavaString.getBytes("UTF-8");\n  mqttConnectOptions.setWill("device-gone", willMsgJavaBytes, 1, true);\n\n  console.log("mqttConnectOptions", mqttConnectOptions);\n\n  const callback = new MqttCallbackExtended({\n    connectComplete: (reconnect, serverUri) => {\n      if (reconnect) {\n        subscribeToTopic();\n        console.log("\u91cd\u65b0\u8fde\u63a5\u5230MQTT");\n      } else {\n        console.log("\u8fde\u63a5\u5230MQTT");\n      }\n    },\n    connectionLost: () => {\n      console.log("MQTT \u8fde\u63a5\u4e22\u5931");\n    },\n    messageArrived: (topic, message) => {\n      console.log("MQTT MESSAGE: ", topic, message);\n    },\n  });\n  client.setCallback(callback);\n\n  client.connect(\n    mqttConnectOptions,\n    null,\n    new IMqttActionListener({\n      onSuccess: () => {\n        console.log("mqtt\u8fde\u63a5\u6210\u529f");\n        subscribeToTopic();\n      },\n      onFailure: (token, error) => {\n        console.error("mqtt\u8fde\u63a5\u5931\u8d25", error);\n        exit();\n      },\n    })\n  );\n};\n\nconst publish = (topic, msg, qos = 1, retained = false) => {\n  // publish message\n  try {\n    let javaString = new java.lang.String(msg);\n    let byteArray = javaString.getBytes("UTF-8");\n    client.publish(topic, byteArray, qos, retained);\n  } catch (error) {\n    console.error("MQTT \u53d1\u5e03\u5931\u8d25", error);\n  }\n};\n\n// \u8fde\u63a5\ninitMQTT();\nsetTimeout(() => {\n  toast("7\u79d2\u540e\u81ea\u52a8\u5173\u95ed");\n  // send message\n  publish(TOPIC, "hello");\n}, 3000);\n// \u65ad\u5f00\u5e76\u9000\u51fa\nsetTimeout(() => {\n  client.close();\n  client.disconnect();\n  toast("\u81ea\u52a8\u5173\u95ed\u5e76\u9000\u51fa\u811a\u672c");\n  exit();\n}, 10 * 1000);\n\n// \u9632\u6b62\u8fdb\u7a0b\u9000\u51fa\nsetInterval(() => {\n  //\n}, 1000);\n'})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(p,{...n})}):p(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>i});var o=t(6540);const s={},c=o.createContext(s);function r(n){const e=o.useContext(c);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),o.createElement(c.Provider,{value:e},n.children)}}}]);